{% extends 'user/userbase.html' %}
{% block title %}My Addresses{% endblock %}
{% block content %}

<div class="col-lg-9 col-md-8 col-12">
  <div class="py-6 p-md-6 p-lg-10">
    <h2 class="mb-4">My Addresses</h2>

    <!-- âœ… Saved Addresses (Top Section) -->
    <h4>Saved Addresses</h4>
    <div class="row mt-3 mb-5">
      {% for addr in addresses %}
      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <h5>{{ addr.first_name }} {{ addr.last_name }}</h5>
            <p class="mb-2">
              {{ addr.address_line1 }}<br>
              {% if addr.address_line2 %}{{ addr.address_line2 }}<br>{% endif %}
              {{ addr.city }}, {{ addr.state }}<br>
              {{ addr.country }} - {{ addr.zip_code }}<br>
              <b>Phone:</b> {{ addr.phone }}
            </p>

            {% if addr.is_default %}
              <span class="badge bg-info text-dark">Default</span>
            {% else %}
              <a href="?default={{ addr.id }}" class="btn btn-outline-primary btn-sm">Set Default</a>
            {% endif %}

            <a href="?edit={{ addr.id }}" class="btn btn-outline-success btn-sm ms-2">Edit</a>
            <a href="?delete={{ addr.id }}" class="btn btn-outline-danger btn-sm ms-2"
               onclick="return confirm('Delete this address?')">Delete</a>
          </div>
        </div>
      </div>
      {% empty %}
      <p>No addresses yet. Add one below.</p>
      {% endfor %}
    </div>

    <hr class="my-5">

    <!-- âœ… Add / Edit Form (Bottom Section) -->
    <h4 class="mb-3">{% if edit_address %}Edit Address{% else %}Add New Address{% endif %}</h4>
    {% if addresses|length < 5 or edit_address %}
    <form method="post" action="{% url 'address' %}" class="border p-4 rounded bg-light">
      {% csrf_token %}
      <input type="hidden" name="address_id" id="address_id" value="{{ edit_address.id|default:'' }}">

      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">First Name</label>
          <input name="first_name" class="form-control" value="{{ edit_address.first_name|default:'' }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Last Name</label>
          <input name="last_name" class="form-control" value="{{ edit_address.last_name|default:'' }}">
        </div>
        <div class="col-md-12">
          <label class="form-label">Address Line 1</label>
          <input name="address_line1" class="form-control" value="{{ edit_address.address_line1|default:'' }}" required>
        </div>
        <div class="col-md-12">
          <label class="form-label">Address Line 2</label>
          <input name="address_line2" class="form-control" value="{{ edit_address.address_line2|default:'' }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">City</label>
          <input name="city" class="form-control" value="{{ edit_address.city|default:'' }}" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">State</label>
          <input name="state" class="form-control" value="{{ edit_address.state|default:'' }}" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Country</label>
          <input name="country" class="form-control" value="{{ edit_address.country|default:'' }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Zip Code</label>
          <input name="zip_code" class="form-control" value="{{ edit_address.zip_code|default:'' }}" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input name="phone" class="form-control" value="{{ edit_address.phone|default:'' }}" required>
        </div>
        <div class="col-md-12">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="is_default" name="is_default"
                   {% if edit_address.is_default %}checked{% endif %}>
            <label class="form-check-label" for="is_default">Set as Default</label>
          </div>
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">
            {% if edit_address %}Update Address{% else %}Save Address{% endif %}
          </button>
          {% if edit_address %}
          <a href="{% url 'address' %}" class="btn btn-outline-secondary ms-2">Cancel Edit</a>
          {% endif %}
        </div>
      </div>
    </form>
    {% endif %}
  </div>
</div>

{% endblock %}
